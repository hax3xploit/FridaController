<!-- templates/scripts.html -->
{% extends "layout.html" %}
{% block content %}
<div class="space-y-6 animate-slide-up">
  <!-- Header Section -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-white">Scripts</h1>
      <div class="flex items-center gap-2 mt-1">
        <span id="attachedBadge" class="px-2 py-1 rounded text-xs bg-slate-700 text-slate-200">Not Attached</span>
        <span id="attachedProcessLabel" class="text-slate-400 text-sm">—</span>
      </div>
      <!-- Detailed process info (shown when attached) -->
      <div id="processInfoPanel" class="hidden mt-2 text-xs text-slate-400 space-y-1">
        <div class="flex items-center gap-4">
          <span>PID: <span id="processInfoPid" class="text-emerald-400 font-mono">—</span></span>
          <span>Package: <span id="processInfoPackage" class="text-blue-400 font-mono">—</span></span>
        </div>
      </div>
    </div>
    <button id="disconnectBtn" onclick="disconnectFromProcess()" class="hidden px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm font-medium transition-all duration-200">
      Disconnect
    </button>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
    <!-- Left Sidebar - Script Library -->
    <div class="xl:col-span-1">
      <div class="glass-effect rounded-xl p-4 border border-slate-700/50">
        <h2 class="text-lg font-semibold text-white mb-3">Script Library</h2>

        <!-- Upload Section -->
        <div class="mb-4">
          <input type="file" id="scriptUpload" class="hidden" accept=".js,.ts,.txt" />
          <label for="scriptUpload" class="w-full flex items-center justify-center px-3 py-2 border-2 border-dashed border-slate-600 rounded-lg hover:border-primary-500 transition-all duration-200 cursor-pointer group">
            <div class="text-center">
              <svg class="w-6 h-6 text-slate-400 group-hover:text-primary-400 mx-auto mb-1 transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              <p class="text-xs text-slate-300 group-hover:text-white transition-colors duration-200">Upload Script</p>
            </div>
          </label>
        </div>

        <!-- Script List -->
        <div class="space-y-2 max-h-[500px] overflow-y-auto">
          <div id="scriptList" class="space-y-2">
            <div class="text-center text-slate-400 py-4 text-sm">Loading scripts...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Editor Area -->
    <div class="xl:col-span-3 space-y-4">
      <!-- Editor Toolbar -->
      <div class="glass-effect rounded-xl p-3 border border-slate-700/50">
        <div class="flex items-center justify-between flex-wrap gap-2">
          <h2 class="text-lg font-semibold text-white">Custom Script</h2>

          <div class="flex items-center space-x-2">
            <button onclick="formatEditorScript()" class="px-3 py-1.5 bg-slate-600 hover:bg-slate-700 rounded-lg text-white text-sm transition-all duration-200">
              Format
            </button>
            <button onclick="validateEditorScript()" class="px-3 py-1.5 bg-amber-600 hover:bg-amber-700 rounded-lg text-white text-sm transition-all duration-200">
              Validate
            </button>
            <button id="spawnInject" class="px-4 py-1.5 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-medium transition-all duration-200 shadow-lg hover:shadow-purple-500/25">
              Spawn & Inject
            </button>
          </div>
        </div>
      </div>

      <!-- Code Editor -->
      <div class="glass-effect rounded-xl border border-slate-700/50 overflow-hidden">
        <div class="bg-dark-900 border-b border-slate-700 px-4 py-2 flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <span class="text-sm text-slate-400 font-mono">frida-script.js</span>
            <!-- Auto-save indicator -->
            <span id="autoSaveIndicator" class="text-xs text-slate-500 hidden">
              <span class="inline-flex items-center">
                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Saved
              </span>
            </span>
          </div>
          <span id="lineCount" class="text-xs text-slate-400">1:1</span>
        </div>
        <div id="editor" class="bg-dark-950" style="height:400px; position:relative; z-index:10;"></div>
      </div>

      <!-- Console Output Panel -->
      <div class="glass-effect rounded-xl border border-slate-700/50 overflow-hidden">
        <div class="bg-dark-900 border-b border-slate-700 px-4 py-2 flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <span class="text-sm text-slate-300 font-mono">Live Console Output</span>
            <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
          </div>
          <div class="flex items-center space-x-2">
            <!-- Console Search -->
            <div class="relative">
              <input type="text" id="consoleSearch" placeholder="Search console..."
                     class="w-40 bg-slate-800 text-white text-xs px-3 py-1 pl-7 rounded border border-slate-600 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
                     oninput="filterConsole(this.value)">
              <svg class="w-3 h-3 text-slate-400 absolute left-2 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>
            <!-- Filter by type -->
            <select id="consoleTypeFilter" class="bg-slate-800 text-white text-xs px-2 py-1 rounded border border-slate-600 focus:ring-1 focus:ring-emerald-500"
                    onchange="filterConsole(document.getElementById('consoleSearch').value)">
              <option value="all">All</option>
              <option value="log">Log</option>
              <option value="info">Info</option>
              <option value="success">Success</option>
              <option value="warn">Warn</option>
              <option value="error">Error</option>
            </select>
            <span id="consoleMatchCount" class="text-xs text-slate-400 hidden">0 matches</span>
            <button onclick="clearConsole()" class="text-xs text-rose-400 hover:text-white transition-all">Clear</button>
          </div>
        </div>
        <div id="consoleOutput" class="bg-slate-900 p-4 text-sm font-mono h-56 overflow-y-auto">
          <!-- Console lines will appear here -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 z-50 bg-black bg-opacity-60 hidden items-center justify-center">
  <div class="bg-slate-800 p-6 rounded-lg shadow-lg w-full max-w-sm text-white border border-slate-600">
    <h3 class="text-lg font-semibold mb-3">Confirm Deletion</h3>
    <p class="text-sm text-slate-300 mb-5">Are you sure you want to delete this script? This action cannot be undone.</p>
    <div class="flex justify-end space-x-3">
      <button onclick="hideDeleteModal()" class="px-4 py-1 rounded bg-slate-600 hover:bg-slate-700 text-sm">Cancel</button>
      <button id="confirmDeleteBtn" class="px-4 py-1 rounded bg-red-600 hover:bg-red-700 text-sm">Delete</button>
    </div>
  </div>
</div>

{% block pagescripts %}
  <script src="/static/js/scripts.js"></script>
  <script src="/static/js/script_library.js"></script>
{% endblock %}
{% endblock %}
